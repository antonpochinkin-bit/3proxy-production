user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
}

stream {
    # Балансировка HTTP прокси (порт 8080)
    upstream http_proxy_auth {
        least_conn;
        server 3proxy1:8080;
        server 3proxy2:8080;
        # Можно добавить больше серверов
    }
    
    # Балансировка SOCKS5 прокси (порт 1080)
    upstream socks5_proxy_auth {
        least_conn;
        server 3proxy1:1080;
        server 3proxy2:1080;
    }
    
    # Балансировка публичного HTTP (порт 3128)
    upstream http_proxy_public {
        least_conn;
        server 3proxy1:3128;
        server 3proxy2:3128;
    }
    
    # Балансировка публичного SOCKS5 (порт 1081)
    upstream socks5_proxy_public {
        least_conn;
        server 3proxy1:1081;
        server 3proxy2:1081;
    }
    
    # Сервер для балансировки HTTP с аутентификацией
    server {
        listen 18080;
        proxy_pass http_proxy_auth;
        proxy_timeout 30s;
        proxy_connect_timeout 10s;
    }
    
    # Сервер для балансировки SOCKS5 с аутентификацией
    server {
        listen 11080;
        proxy_pass socks5_proxy_auth;
        proxy_timeout 30s;
        proxy_connect_timeout 10s;
    }
    
    # Сервер для балансировки публичного HTTP
    server {
        listen 13128;
        proxy_pass http_proxy_public;
        proxy_timeout 30s;
        proxy_connect_timeout 10s;
    }
    
    # Сервер для балансировки публичного SOCKS5
    server {
        listen 11081;
        proxy_pass socks5_proxy_public;
        proxy_timeout 30s;
        proxy_connect_timeout 10s;
    }
}

http {
    # Веб-интерфейс для мониторинга
    server {
        listen 80;
        server_name localhost;
        
        location /status {
            stub_status on;
            access_log off;
            allow 127.0.0.1;
            deny all;
        }
        
        location / {
            root /usr/share/nginx/html;
            index index.html;
        }
    }
}
